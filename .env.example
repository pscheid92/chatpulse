# Application Environment
APP_ENV=development
PORT=8080

# Database
DATABASE_URL=postgres://twitchuser:twitchpass@localhost:5432/twitchdb?sslmode=disable

# Database Connection Pool Configuration (optional, defaults shown)
# Tune these based on expected session activation rate and query latency
# Formula: max_conns = peak_activations_per_sec * avg_query_latency_sec * safety_factor
DB_MIN_CONNS=2                    # Minimum idle connections
DB_MAX_CONNS=10                   # Maximum pool size (0 = auto-detect from CPU)
DB_MAX_CONN_IDLE_TIME=5m          # Close idle connections after this duration
DB_HEALTH_CHECK_PERIOD=1m         # Background health check interval
DB_CONNECT_TIMEOUT=5s             # Connection establishment timeout
DB_MAX_RETRIES=3                  # Connection retry attempts (exponential backoff)
DB_INITIAL_BACKOFF=1s             # Initial backoff duration

# Twitch OAuth
TWITCH_CLIENT_ID=your_twitch_client_id_here
TWITCH_CLIENT_SECRET=your_twitch_client_secret_here
TWITCH_REDIRECT_URI=http://localhost:8080/auth/callback

# Session Secret (generate a random string)
SESSION_SECRET=your_random_session_secret_here

# Webhook (required for receiving chat messages)
# Use ngrok for local dev: ngrok http 8080, then set the URL below
WEBHOOK_CALLBACK_URL=https://your-ngrok-subdomain.ngrok-free.app/webhooks/eventsub
WEBHOOK_SECRET=your_webhook_secret_at_least_10_chars

# Bot Account (required when WEBHOOK_CALLBACK_URL is set)
# The Twitch user ID of the dedicated bot account that reads chat
BOT_USER_ID=

# Logging Configuration
# LOG_LEVEL: debug, info, warn, error (default: info)
# LOG_FORMAT: text, json (default: text, use json for production)
LOG_LEVEL=info
LOG_FORMAT=text

# WebSocket Connection Limits
# Protect against DoS attacks and resource exhaustion
MAX_WEBSOCKET_CONNECTIONS=10000  # Maximum total connections per instance
MAX_CONNECTIONS_PER_IP=100       # Maximum connections from a single IP
CONNECTION_RATE_PER_IP=10        # Maximum new connections per second per IP
CONNECTION_RATE_BURST=20         # Burst allowance for connection rate limiter

# Vote Rate Limiting (Token Bucket)
# Prevents coordinated bot attacks while allowing legitimate burst activity
VOTE_RATE_LIMIT_CAPACITY=100  # Burst allowance (tokens) - allows this many votes immediately
VOTE_RATE_LIMIT_RATE=100      # Sustained rate (tokens per minute) - refills at this rate

# Performance Tuning (optional, defaults shown)
# Tune these based on instance size and observed metrics
BROADCASTER_MAX_CLIENTS_PER_SESSION=50  # Max WebSocket connections per session
BROADCASTER_TICK_INTERVAL=50ms          # How often to pull values and broadcast
CLEANUP_INTERVAL=30s                    # Orphan session scan frequency
ORPHAN_MAX_AGE=30s                      # How long before disconnected session deleted
SESSION_MAX_AGE=168h                    # HTTP session cookie expiry (7 days)
